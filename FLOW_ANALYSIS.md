# Aè‚¡æ™ºèƒ½åˆ†æç³»ç»Ÿ - æ‰§è¡Œæµç¨‹è¯¦è§£

## ä¸€ã€æ•´ä½“æ¶æ„æ¦‚è§ˆ

### 1.1 ç³»ç»Ÿåˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å…¥å£å±‚                                â”‚
â”‚  main.py | test_env.py | webui.py | GitHub Actions               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        è°ƒåº¦æ§åˆ¶å±‚                                 â”‚
â”‚  StockAnalysisPipeline (main.py) - æ ¸å¿ƒåè°ƒå™¨                    â”‚
â”‚  Scheduler (scheduler.py) - å®šæ—¶ä»»åŠ¡è°ƒåº¦                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸šåŠ¡é€»è¾‘å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ æ•°æ®è·å–      â”‚  â”‚ æ•°æ®åˆ†æ      â”‚  â”‚ é€šçŸ¥æ¨é€      â”‚           â”‚
â”‚  â”‚ DataFetcher  â”‚  â”‚ Analyzer     â”‚  â”‚ Notification â”‚           â”‚
â”‚  â”‚ Manager      â”‚  â”‚ TrendAnalyzerâ”‚  â”‚ MarketAnalyzerâ”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å­˜å‚¨å±‚                                 â”‚
â”‚  DatabaseManager (storage.py) - SQLite + SQLAlchemy              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒæ¨¡å—èŒè´£

| æ¨¡å— | æ–‡ä»¶ | èŒè´£ |
|------|------|------|
| **ä¸»ç¨‹åº** | main.py | æµç¨‹è°ƒåº¦ã€å‚æ•°è§£æã€å¼‚å¸¸å¤„ç† |
| **é…ç½®ç®¡ç†** | config.py | å•ä¾‹é…ç½®ã€ç¯å¢ƒå˜é‡åŠ è½½ |
| **æ•°æ®æº** | data_provider/* | å¤šæ•°æ®æºé€‚é…å™¨ï¼ˆEfinance/Akshare/Tushareç­‰ï¼‰ |
| **æ•°æ®å­˜å‚¨** | storage.py | SQLite ORMã€æ–­ç‚¹ç»­ä¼  |
| **AIåˆ†æ** | analyzer.py | Gemini API è°ƒç”¨ã€å†³ç­–ä»ªè¡¨ç›˜ç”Ÿæˆ |
| **è¶‹åŠ¿åˆ†æ** | stock_analyzer.py | æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ã€äº¤æ˜“ç†å¿µå®ç° |
| **æ–°é—»æœç´¢** | search_service.py | å¤šå¼•æ“æ–°é—»æœç´¢ï¼ˆTavily/Bocha/SerpAPIï¼‰ |
| **å¤§ç›˜å¤ç›˜** | market_analyzer.py | æŒ‡æ•°è¡Œæƒ…ã€æ¿å—æ¶¨è·Œã€åŒ—å‘èµ„é‡‘ |
| **é€šçŸ¥æ¨é€** | notification.py | å¤šæ¸ é“æ¨é€ï¼ˆä¼ä¸šå¾®ä¿¡/é£ä¹¦/Telegram/é‚®ä»¶ï¼‰ |
| **å®šæ—¶ä»»åŠ¡** | scheduler.py | æ¯æ—¥å®šæ—¶æ‰§è¡Œ |
| **é£ä¹¦æ–‡æ¡£** | feishu_doc.py | äº‘æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ |
| **WebUI** | web/* | FastAPI é…ç½®ç®¡ç†ç•Œé¢ |

---

## äºŒã€ä¸»æ‰§è¡Œæµç¨‹è¯¦è§£

### 2.1 ç¨‹åºå¯åŠ¨æµç¨‹ï¼ˆmain.pyï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  main() ä¸»å‡½æ•°                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. parse_arguments() - è§£æå‘½ä»¤è¡Œå‚æ•°                        â”‚
â”‚     --debug / --dry-run / --stocks / --schedule / --webui     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. get_config() - åŠ è½½é…ç½®ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰                        â”‚
â”‚     - ä» .env æ–‡ä»¶è¯»å–                                       â”‚
â”‚     - ä»ç³»ç»Ÿç¯å¢ƒå˜é‡è¯»å–                                      â”‚
â”‚     - éªŒè¯é…ç½®å®Œæ•´æ€§                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. setup_logging() - é…ç½®æ—¥å¿—ç³»ç»Ÿ                            â”‚
â”‚     - æ§åˆ¶å°è¾“å‡ºï¼ˆINFO/DEBUGï¼‰                                â”‚
â”‚     - æ–‡ä»¶è¾“å‡ºï¼ˆå¸¸è§„æ—¥å¿— + è°ƒè¯•æ—¥å¿—ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. åˆ¤æ–­è¿è¡Œæ¨¡å¼                                               â”‚
â”‚     â”œâ”€ --webui/--webui-only  â†’ å¯åŠ¨ WebUI æœåŠ¡               â”‚
â”‚     â”œâ”€ --market-review      â†’ ä»…è¿è¡Œå¤§ç›˜å¤ç›˜                  â”‚
â”‚     â”œâ”€ --schedule           â†’ å¯åŠ¨å®šæ—¶ä»»åŠ¡                    â”‚
â”‚     â””â”€ é»˜è®¤æ¨¡å¼             â†’ run_full_analysis()            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å®Œæ•´åˆ†ææµç¨‹ï¼ˆrun_full_analysisï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  run_full_analysis() - å®Œæ•´åˆ†æä¸»å‡½æ•°                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»º StockAnalysisPipeline è°ƒåº¦å™¨                           â”‚
â”‚  â”œâ”€ DatabaseManager (æ•°æ®åº“)                                 â”‚
â”‚  â”œâ”€ DataFetcherManager (æ•°æ®æºç®¡ç†å™¨)                        â”‚
â”‚  â”œâ”€ AkshareFetcher (å®æ—¶è¡Œæƒ…/ç­¹ç )                           â”‚
â”‚  â”œâ”€ StockTrendAnalyzer (è¶‹åŠ¿åˆ†æå™¨)                         â”‚
â”‚  â”œâ”€ GeminiAnalyzer (AIåˆ†æå™¨)                                â”‚
â”‚  â”œâ”€ NotificationService (é€šçŸ¥æœåŠ¡)                           â”‚
â”‚  â””â”€ SearchService (æ–°é—»æœç´¢æœåŠ¡)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰§è¡Œä¸ªè‚¡åˆ†æï¼špipeline.run()                                 â”‚
â”‚  â”œâ”€ å¹¶å‘å¤„ç†ï¼ˆThreadPoolExecutor, max_workers=3ï¼‰            â”‚
â”‚  â””â”€ å¯¹æ¯åªè‚¡ç¥¨æ‰§è¡Œ process_single_stock()                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰§è¡Œå¤§ç›˜å¤ç›˜ï¼ˆå¯é€‰ï¼‰                                         â”‚
â”‚  â””â”€ run_market_review()                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”Ÿæˆé£ä¹¦äº‘æ–‡æ¡£ï¼ˆå¯é€‰ï¼‰                                       â”‚
â”‚  â””â”€ FeishuDocManager.create_daily_doc()                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€ä¸ªè‚¡åˆ†æè¯¦ç»†æµç¨‹

### 3.1 å•è‚¡å¤„ç†æµç¨‹ï¼ˆprocess_single_stockï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  process_single_stock(code) - å¤„ç†å•åªè‚¡ç¥¨                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: è·å–å¹¶ä¿å­˜å†å²æ•°æ®                                 â”‚
â”‚  fetch_and_save_stock_data(code)                             â”‚
â”‚  â”œâ”€ æ£€æŸ¥æ–­ç‚¹ç»­ä¼ ï¼ˆä»Šæ—¥æ•°æ®æ˜¯å¦å­˜åœ¨ï¼‰                        â”‚
â”‚  â””â”€ è°ƒç”¨ DataFetcherManager.get_daily_data()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: AI åˆ†æ                                             â”‚
â”‚  analyze_stock(code)                                         â”‚
â”‚  â”œâ”€ è·å–å®æ—¶è¡Œæƒ…ï¼ˆä»·æ ¼ã€é‡æ¯”ã€æ¢æ‰‹ç‡ç­‰ï¼‰                      â”‚
â”‚  â”œâ”€ è·å–ç­¹ç åˆ†å¸ƒï¼ˆè·åˆ©æ¯”ä¾‹ã€é›†ä¸­åº¦ï¼‰                         â”‚
â”‚  â”œâ”€ è¶‹åŠ¿åˆ†æï¼ˆMAæ’åˆ—ã€ä¹–ç¦»ç‡ã€é‡èƒ½ï¼‰                          â”‚
â”‚  â”œâ”€ æ–°é—»æœç´¢ï¼ˆå¤šç»´åº¦æƒ…æŠ¥ï¼‰                                   â”‚
â”‚  â”œâ”€ æ„å»ºå¢å¼ºä¸Šä¸‹æ–‡                                           â”‚
â”‚  â””â”€ è°ƒç”¨ Gemini API ç”Ÿæˆå†³ç­–ä»ªè¡¨ç›˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: å•è‚¡æ¨é€ï¼ˆå¯é€‰ï¼‰                                    â”‚
â”‚  if single_stock_notify:                                     â”‚
â”‚  â””â”€ notifier.send() - ç«‹å³æ¨é€æ­¤è‚¡ç¥¨æŠ¥å‘Š                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
  è¿”å› AnalysisResult
```

### 3.2 æ•°æ®è·å–æµç¨‹ï¼ˆå¤šæ•°æ®æºé™çº§ç­–ç•¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DataFetcherManager.get_daily_data(code, days=30)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆå§‹åŒ–æ•°æ®æºï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰                                 â”‚
â”‚  ã€æœ‰ TUSHARE_TOKENã€‘                                        â”‚
â”‚  Priority 0: TushareFetcher                                  â”‚
â”‚  Priority 0: EfinanceFetcher                                 â”‚
â”‚  Priority 1: AkshareFetcher                                 â”‚
â”‚  Priority 3: BaostockFetcher                                â”‚
â”‚  Priority 4: YfinanceFetcher                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æŒ‰ä¼˜å…ˆçº§å°è¯•æ¯ä¸ªæ•°æ®æº                                       â”‚
â”‚  for fetcher in sorted_fetchers:                            â”‚
â”‚    try:                                                      â”‚
â”‚      â”œâ”€ fetcher._fetch_raw_data() - è·å–åŸå§‹æ•°æ®            â”‚
â”‚      â”œâ”€ fetcher._normalize_data() - æ ‡å‡†åŒ–åˆ—å             â”‚
â”‚      â”œâ”€ fetcher._calculate_indicators() - è®¡ç®—æŠ€æœ¯æŒ‡æ ‡       â”‚
â”‚      â””â”€ æˆåŠŸè¿”å› DataFrame                                   â”‚
â”‚    except Exception:                                          â”‚
â”‚      â””â”€ è®°å½•å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€ä¸ªæ•°æ®æº                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰                                     â”‚
â”‚  DatabaseManager.save_daily_data(df, code, source_name)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŠ€æœ¯æŒ‡æ ‡è®¡ç®—**ï¼ˆåœ¨ BaseFetcher._calculate_indicators ä¸­ï¼‰ï¼š
- MA5/MA10/MA20: ç§»åŠ¨å¹³å‡çº¿
- é‡æ¯”: å½“æ—¥æˆäº¤é‡ / è¿‡å»5æ—¥å¹³å‡æˆäº¤é‡
- æ¶¨è·Œå¹…: (æ”¶ç›˜ä»· - æ˜¨æ”¶) / æ˜¨æ”¶ Ã— 100%

### 3.3 æ•°æ®å¢å¼ºæµç¨‹ï¼ˆanalyze_stockï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  analyze_stock(code) - AIåˆ†æä¸»æµç¨‹                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 1ã€‘è·å–å®æ—¶è¡Œæƒ…                                      â”‚
â”‚  AkshareFetcher.get_realtime_quote(code)                    â”‚
â”‚  â”œâ”€ å®æ—¶ä»·æ ¼ã€é‡æ¯”ã€æ¢æ‰‹ç‡                                    â”‚
â”‚  â”œâ”€ PE/PB ä¼°å€¼æŒ‡æ ‡                                           â”‚
â”‚  â”œâ”€ å¸‚å€¼æ•°æ®                                                 â”‚
â”‚  â””â”€ 60æ—¥æ¶¨è·Œå¹…                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 2ã€‘è·å–ç­¹ç åˆ†å¸ƒ                                      â”‚
â”‚  AkshareFetcher.get_chip_distribution(code)                 â”‚
â”‚  â”œâ”€ è·åˆ©æ¯”ä¾‹ï¼ˆè·åˆ©ç›˜å æ¯”ï¼‰                                    â”‚
â”‚  â”œâ”€ å¹³å‡æˆæœ¬                                                 â”‚
â”‚  â”œâ”€ 90%é›†ä¸­åº¦ï¼ˆç­¹ç é›†ä¸­åº¦ï¼‰                                  â”‚
â”‚  â””â”€ 70%é›†ä¸­åº¦                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 3ã€‘è¶‹åŠ¿åˆ†æï¼ˆåŸºäºäº¤æ˜“ç†å¿µï¼‰                           â”‚
â”‚  StockTrendAnalyzer.analyze(df, code)                        â”‚
â”‚  â”œâ”€ å‡çº¿æ’åˆ—åˆ¤æ–­ï¼ˆMA5>MA10>MA20 å¤šå¤´æ’åˆ—ï¼‰                   â”‚
â”‚  â”œâ”€ ä¹–ç¦»ç‡è®¡ç®—ï¼š(ç°ä»·-MA5)/MA5 * 100%                        â”‚
â”‚  â”œâ”€ é‡èƒ½åˆ†æï¼ˆæ”¾é‡/ç¼©é‡ï¼‰                                    â”‚
â”‚  â”œâ”€ æ”¯æ’‘å‹åŠ›ä½è¯†åˆ«                                            â”‚
â”‚  â”œâ”€ ä¹°å…¥ä¿¡å·ç”Ÿæˆï¼ˆå¼ºçƒˆä¹°å…¥/ä¹°å…¥/æŒæœ‰/è§‚æœ›/å–å‡ºï¼‰             â”‚
â”‚  â””â”€ ç»¼åˆè¯„åˆ†ï¼ˆ0-100ï¼‰                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 4ã€‘å¤šç»´åº¦æƒ…æŠ¥æœç´¢                                    â”‚
â”‚  SearchService.search_comprehensive_intel(code, name)      â”‚
â”‚  â”œâ”€ æœç´¢æ–¹å‘1ï¼šæœ€æ–°æ¶ˆæ¯ï¼ˆå…¬å¸åŠ¨æ€ã€ä¸šç»©é¢„å‘Šï¼‰                 â”‚
â”‚  â”œâ”€ æœç´¢æ–¹å‘2ï¼šé£é™©æ’æŸ¥ï¼ˆå‡æŒã€å¤„ç½šã€è§£ç¦ï¼‰                   â”‚
â”‚  â”œâ”€ æœç´¢æ–¹å‘3ï¼šè¡Œä¸šæ–°é—»ï¼ˆæ¿å—èµ°åŠ¿ã€æ”¿ç­–å˜åŒ–ï¼‰                 â”‚
â”‚  â”œâ”€ å¤šå¼•æ“è´Ÿè½½å‡è¡¡ï¼ˆTavily/Bocha/SerpAPIï¼‰                   â”‚
â”‚  â””â”€ æ ¼å¼åŒ–æƒ…æŠ¥æŠ¥å‘Š                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 5ã€‘è·å–åˆ†æä¸Šä¸‹æ–‡ï¼ˆæŠ€æœ¯é¢æ•°æ®ï¼‰                       â”‚
â”‚  DatabaseManager.get_analysis_context(code)                 â”‚
â”‚  â”œâ”€ æœ€è¿‘30å¤©å†å²æ•°æ®                                         â”‚
â”‚  â”œâ”€ è®¡ç®—å‡ºçš„æŠ€æœ¯æŒ‡æ ‡ï¼ˆMAã€é‡æ¯”ï¼‰                             â”‚
â”‚  â””â”€ è½¬æ¢ä¸ºå­—å…¸æ ¼å¼                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 6ã€‘å¢å¼ºä¸Šä¸‹æ–‡æ•°æ®                                    â”‚
â”‚  _enhance_context(context, realtime, chip, trend, name)    â”‚
â”‚  â”œâ”€ æ·»åŠ å®æ—¶è¡Œæƒ…æ•°æ®                                         â”‚
â”‚  â”œâ”€ æ·»åŠ ç­¹ç åˆ†å¸ƒæ•°æ®                                         â”‚
â”‚  â”œâ”€ æ·»åŠ è¶‹åŠ¿åˆ†æç»“æœ                                         â”‚
â”‚  â””â”€ æ·»åŠ è‚¡ç¥¨åç§°                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 7ã€‘AI åˆ†æ                                           â”‚
â”‚  GeminiAnalyzer.analyze(enhanced_context, news_context)    â”‚
â”‚  â”œâ”€ æ„é€  Promptï¼ˆå†³ç­–ä»ªè¡¨ç›˜æ ¼å¼ï¼‰                            â”‚
â”‚  â”œâ”€ è°ƒç”¨ Gemini APIï¼ˆå¸¦é‡è¯•æœºåˆ¶ï¼‰                            â”‚
â”‚  â”œâ”€ è§£æ JSON å“åº”                                           â”‚
â”‚  â””â”€ è¿”å› AnalysisResult                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 AI åˆ†æè¯¦ç»†æµç¨‹ï¼ˆGeminiAnalyzerï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GeminiAnalyzer.analyze(context, news_context)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Prompt æ„é€ ã€‘                                             â”‚
â”‚  SYSTEM_PROMPT = """                                         â”‚
â”‚  ä½ æ˜¯ä¸€ä½ä¸“æ³¨äºè¶‹åŠ¿äº¤æ˜“çš„ A è‚¡æŠ•èµ„åˆ†æå¸ˆ...                   â”‚
â”‚  æ ¸å¿ƒäº¤æ˜“ç†å¿µï¼š                                               â”‚
â”‚  1. ä¸¥è¿›ç­–ç•¥ï¼ˆä¸è¿½é«˜ï¼‰- ä¹–ç¦»ç‡>5%ä¸¥ç¦è¿½é«˜                    â”‚
â”‚  2. è¶‹åŠ¿äº¤æ˜“ï¼ˆé¡ºåŠ¿è€Œä¸ºï¼‰- MA5>MA10>MA20å¤šå¤´æ’åˆ—              â”‚
â”‚  3. æ•ˆç‡ä¼˜å…ˆï¼ˆç­¹ç ç»“æ„ï¼‰- å…³æ³¨ç­¹ç é›†ä¸­åº¦                      â”‚
â”‚  4. ä¹°ç‚¹åå¥½ï¼ˆå›è¸©æ”¯æ’‘ï¼‰- ç¼©é‡å›è¸©MA5/MA10                   â”‚
â”‚  5. é£é™©æ’æŸ¥é‡ç‚¹ - å‡æŒã€ä¸šç»©ä¸‹æ»‘ã€å¤„ç½šã€åˆ©ç©ºã€è§£ç¦          â”‚
â”‚  """                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€ä¸Šä¸‹æ–‡æ ¼å¼åŒ–ã€‘                                             â”‚
â”‚  USER_PROMPT = f"""                                           â”‚
â”‚  è¯·åˆ†æä»¥ä¸‹è‚¡ç¥¨ï¼Œç”Ÿæˆå†³ç­–ä»ªè¡¨ç›˜ï¼š                              â”‚
â”‚                                                             â”‚
â”‚  ã€åŸºæœ¬ä¿¡æ¯ã€‘                                                 â”‚
â”‚  è‚¡ç¥¨ä»£ç : {code}                                            â”‚
â”‚  è‚¡ç¥¨åç§°: {name}                                            â”‚
â”‚  åˆ†ææ—¥æœŸ: {date}                                            â”‚
â”‚                                                             â”‚
â”‚  ã€æŠ€æœ¯é¢æ•°æ®ã€‘                                               â”‚
â”‚  - æœ€æ–°æ”¶ç›˜ä»·ã€æ¶¨è·Œå¹…ã€æˆäº¤é‡                                 â”‚
â”‚  - MA5/MA10/MA20 æ•°å€¼åŠæ’åˆ—                                  â”‚
â”‚  - ä¹–ç¦»ç‡ (bias_ma5)                                         â”‚
â”‚  - é‡æ¯”ã€æ¢æ‰‹ç‡                                               â”‚
â”‚                                                             â”‚
â”‚  ã€ç­¹ç åˆ†æã€‘                                                 â”‚
â”‚  - è·åˆ©æ¯”ä¾‹ã€å¹³å‡æˆæœ¬ã€é›†ä¸­åº¦                                 â”‚
â”‚                                                             â”‚
â”‚  ã€è¶‹åŠ¿åˆ†æã€‘                                                 â”‚
â”‚  - è¶‹åŠ¿çŠ¶æ€ã€ä¹°å…¥ä¿¡å·ã€è¯„åˆ†                                   â”‚
â”‚                                                             â”‚
â”‚  ã€èˆ†æƒ…æƒ…æŠ¥ã€‘ï¼ˆå¦‚æœ‰ï¼‰                                         â”‚
â”‚  {news_context}                                             â”‚
â”‚                                                             â”‚
â”‚  è¯·ä¸¥æ ¼æŒ‰ç…§å†³ç­–ä»ªè¡¨ç›˜ JSON æ ¼å¼è¾“å‡º...                        â”‚
â”‚  """                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€API è°ƒç”¨ã€‘                                                 â”‚
â”‚  try:                                                        â”‚
â”‚    response = model.generate_content(                       â”‚
â”‚      contents=[USER_PROMPT],                                 â”‚
â”‚      config={                                                 â”‚
â”‚        "temperature": 0.7,                                  â”‚
â”‚        "max_output_tokens": 2048,                            â”‚
â”‚      }                                                       â”‚
â”‚    )                                                         â”‚
â”‚  except Exception:                                           â”‚
â”‚    â””â”€ é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š5æ¬¡ï¼ŒæŒ‡æ•°é€€é¿ï¼‰                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€ç»“æœè§£æã€‘                                                 â”‚
â”‚  1. æå– JSON å­—ç¬¦ä¸²                                          â”‚
â”‚  2. è§£æä¸º Python å­—å…¸                                       â”‚
â”‚  3. æ„é€  AnalysisResult å¯¹è±¡                                â”‚
â”‚  4. éªŒè¯å¿…å¡«å­—æ®µ                                             â”‚
â”‚  5. æå–å†³ç­–ä»ªè¡¨ç›˜æ•°æ®                                       â”‚
â”‚     â”œâ”€ core_conclusionï¼ˆæ ¸å¿ƒç»“è®ºï¼‰                           â”‚
â”‚     â”œâ”€ data_perspectiveï¼ˆæ•°æ®é€è§†ï¼‰                          â”‚
â”‚     â”œâ”€ intelligenceï¼ˆèˆ†æƒ…æƒ…æŠ¥ï¼‰                              â”‚
â”‚     â””â”€ battle_planï¼ˆä½œæˆ˜è®¡åˆ’ï¼‰                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å†³ç­–ä»ªè¡¨ç›˜ JSON ç»“æ„**ï¼š

```json
{
  "sentiment_score": 75,
  "trend_prediction": "çœ‹å¤š",
  "operation_advice": "ä¹°å…¥",
  "confidence_level": "é«˜",

  "dashboard": {
    "core_conclusion": {
      "one_sentence": "ç¼©é‡å›è¸©MA5æ”¯æ’‘ï¼Œä¹–ç¦»ç‡1.2%å¤„äºæœ€ä½³ä¹°ç‚¹",
      "signal_type": "ğŸŸ¢ä¹°å…¥ä¿¡å·",
      "time_sensitivity": "ä»Šæ—¥å†…",
      "position_advice": {
        "no_position": "å¯å°ä»“ä»‹å…¥",
        "has_position": "åšå®šæŒæœ‰"
      }
    },

    "data_perspective": {
      "trend_status": {...},
      "price_position": {...},
      "volume_analysis": {...},
      "chip_structure": {...}
    },

    "intelligence": {
      "latest_news": "...",
      "risk_alerts": [...],
      "opportunity_points": [...]
    },

    "battle_plan": {
      "sniper_points": {
        "buy_price": "1800",
        "stop_loss": "1750",
        "target_price": "1900"
      },
      "action_checklist": [
        "âœ…å¤šå¤´æ’åˆ—",
        "âœ…ä¹–ç¦»å®‰å…¨",
        "âœ…é‡èƒ½é…åˆ"
      ],
      "exit_strategy": "..."
    }
  }
}
```

---

## å››ã€é€šçŸ¥æ¨é€æµç¨‹

### 4.1 æ¨é€æ¨¡å¼é€‰æ‹©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•è‚¡æ¨é€æ¨¡å¼ï¼ˆSINGLE_STOCK_NOTIFY=trueï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¯åˆ†æå®Œä¸€åªè‚¡ç¥¨ç«‹å³æ¨é€                                     â”‚
â”‚  for each stock:                                            â”‚
â”‚    â”œâ”€ analyze_stock(code)                                    â”‚
â”‚    â”œâ”€ generate_single_stock_report(result)                  â”‚
â”‚    â””â”€ send(report)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ±‡æ€»æ¨é€æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰€æœ‰è‚¡ç¥¨åˆ†æå®Œæˆåç»Ÿä¸€æ¨é€                                   â”‚
â”‚  â”œâ”€ æ”¶é›†æ‰€æœ‰ AnalysisResult                                 â”‚
â”‚  â”œâ”€ generate_dashboard_report(results)                      â”‚
â”‚  â””â”€ send(report)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å¤šæ¸ é“æ¨é€æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NotificationService.send(report_content)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è·å–å¯ç”¨æ¸ é“                                                 â”‚
â”‚  get_available_channels()                                    â”‚
â”‚  â”œâ”€ WECHATï¼ˆä¼ä¸šå¾®ä¿¡ Webhookï¼‰                               â”‚
â”‚  â”œâ”€ FEISHUï¼ˆé£ä¹¦ Webhookï¼‰                                   â”‚
â”‚  â”œâ”€ TELEGRAMï¼ˆTelegram Botï¼‰                                 â”‚
â”‚  â”œâ”€ EMAILï¼ˆSMTP é‚®ä»¶ï¼‰                                       â”‚
â”‚  â”œâ”€ PUSHOVERï¼ˆæ‰‹æœºæ¨é€ï¼‰                                     â”‚
â”‚  â””â”€ CUSTOMï¼ˆè‡ªå®šä¹‰ Webhookï¼‰                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¼ä¸šå¾®ä¿¡ç‰¹æ®Šå¤„ç†ï¼ˆé•¿åº¦é™åˆ¶ 4KBï¼‰                              â”‚
â”‚  if len(content) > 4000:                                    â”‚
â”‚    â””â”€ ç”Ÿæˆç²¾ç®€ç‰ˆä»ªè¡¨ç›˜                                        â”‚
â”‚  send_to_wechat(content)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…¶ä»–æ¸ é“æ¨é€ï¼ˆå®Œæ•´ç‰ˆï¼‰                                       â”‚
â”‚  for channel in other_channels:                             â”‚
â”‚    â”œâ”€ send_to_feishu(content) - åˆ†æ‰¹å‘é€ï¼ˆ20KBé™åˆ¶ï¼‰         â”‚
â”‚    â”œâ”€ send_to_telegram(content)                              â”‚
â”‚    â”œâ”€ send_to_email(content) - HTMLé‚®ä»¶                      â”‚
â”‚    â”œâ”€ send_to_custom(content) - POST JSON                    â”‚
â”‚    â””â”€ send_to_pushover(content)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€å¤§ç›˜å¤ç›˜æµç¨‹

### 5.1 å¤§ç›˜å¤ç›˜æ‰§è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  run_market_review(notifier, analyzer, search_service)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 1ã€‘è·å–ä¸»è¦æŒ‡æ•°æ•°æ®                                   â”‚
â”‚  MarketAnalyzer.fetch_market_indices()                      â”‚
â”‚  â”œâ”€ ä¸Šè¯æŒ‡æ•° (sh000001)                                       â”‚
â”‚  â”œâ”€ æ·±è¯æˆæŒ‡ (sz399001)                                       â”‚
â”‚  â”œâ”€ åˆ›ä¸šæ¿æŒ‡ (sz399006)                                       â”‚
â”‚  â”œâ”€ ç§‘åˆ›50 (sh000688)                                         â”‚
â”‚  â”œâ”€ ä¸Šè¯50 (sh000016)                                         â”‚
â”‚  â””â”€ æ²ªæ·±300 (sh000300)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 2ã€‘è·å–å¸‚åœºæ¦‚å†µ                                       â”‚
â”‚  MarketAnalyzer.fetch_market_overview()                     â”‚
â”‚  â”œâ”€ æ¶¨è·Œå®¶æ•°ç»Ÿè®¡                                             â”‚
â”‚  â”œâ”€ æ¶¨è·Œåœå®¶æ•°                                               â”‚
â”‚  â”œâ”€ ä¸¤å¸‚æˆäº¤é¢                                               â”‚
â”‚  â””â”€ åŒ—å‘èµ„é‡‘å‡€æµå…¥                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 3ã€‘è·å–æ¿å—æ¶¨è·Œæ¦œ                                     â”‚
â”‚  MarketAnalyzer.fetch_sector_performance()                  â”‚
â”‚  â”œâ”€ æ¶¨å¹…å‰5æ¿å—                                              â”‚
â”‚  â””â”€ è·Œå¹…å‰5æ¿å—                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 4ã€‘å¸‚åœºæ–°é—»æœç´¢ï¼ˆå¯é€‰ï¼‰                                â”‚
â”‚  search_service.search_market_news()                        â”‚
â”‚  â”œâ”€ å¸‚åœºçƒ­ç‚¹æ–°é—»                                             â”‚
â”‚  â”œâ”€ æ”¿ç­–æ¶ˆæ¯                                                 â”‚
â”‚  â””â”€ è¡Œä¸šåŠ¨æ€                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 5ã€‘AI ç”Ÿæˆå¤ç›˜æŠ¥å‘Šï¼ˆå¯é€‰ï¼‰                            â”‚
â”‚  if analyzer:                                                â”‚
â”‚    market_report = analyzer.generate_market_review(...)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ã€Step 6ã€‘æ¨é€å¤ç›˜æŠ¥å‘Š                                       â”‚
â”‚  ä¿å­˜åˆ°æ–‡ä»¶ + æ¨é€åˆ°é€šçŸ¥æ¸ é“                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…­ã€å®šæ—¶ä»»åŠ¡æµç¨‹

### 6.1 å®šæ—¶ä»»åŠ¡è°ƒåº¦æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Scheduler.run() - ä¸»å¾ªç¯                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  while not shutdown_requested:                               â”‚
â”‚    â”œâ”€ schedule.run_pending() - æ‰§è¡Œåˆ°æœŸä»»åŠ¡                  â”‚
â”‚    â”œâ”€ time.sleep(30) - 30ç§’æ£€æŸ¥ä¸€æ¬¡                           â”‚
â”‚    â””â”€ æ¯å°æ—¶è¾“å‡ºå¿ƒè·³æ—¥å¿—                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¯æ—¥å®šæ—¶è§¦å‘ï¼ˆé»˜è®¤ 18:00ï¼‰                                   â”‚
â”‚  scheduled_task():                                          â”‚
â”‚    â””â”€ run_full_analysis()                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 ä¼˜é›…é€€å‡ºæœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GracefulShutdown - ä¿¡å·å¤„ç†å™¨                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”œâ”€ æ•è· SIGINT (Ctrl+C)                                      â”‚
  â”œâ”€ æ•è· SIGTERM (ç³»ç»Ÿç»ˆæ­¢)                                   â”‚
  â”œâ”€ è®¾ç½® shutdown_requested = True                            â”‚
  â””â”€ ç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆåå†é€€å‡º                                  â”‚
```

---

## ä¸ƒã€WebUI æµç¨‹

### 7.1 WebUI æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è®¿é—® http://127.0.0.1:8000                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI æœåŠ¡å™¨ (web/server.py)                             â”‚
â”‚  â””â”€ run_server(host, port)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è·¯ç”±åˆ†å‘ (web/router.py)                                    â”‚
â”‚  â”œâ”€ GET  /            â†’ PageHandler.config_page()          â”‚
â”‚  â”œâ”€ GET  /health      â†’ PageHandler.health()                â”‚
â”‚  â”œâ”€ GET  /analysis    â†’ ApiHandler.trigger_analysis()      â”‚
â”‚  â”œâ”€ GET  /tasks       â†’ ApiHandler.get_tasks()              â”‚
â”‚  â”œâ”€ GET  /task        â†’ ApiHandler.get_task()               â”‚
â”‚  â””â”€ POST /update      â†’ ApiHandler.update_config()         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸šåŠ¡é€»è¾‘å±‚ (web/services.py)                                â”‚
â”‚  â”œâ”€ ConfigService - é…ç½®ç®¡ç†                                 â”‚
â”‚  â””â”€ AnalysisService - åˆ†æä»»åŠ¡ç®¡ç†                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTML æ¨¡æ¿æ¸²æŸ“ (web/templates.py)                           â”‚
â”‚  â””â”€ render_config_page()                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 å¼‚æ­¥åˆ†ææµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è§¦å‘ï¼šGET /analysis?code=600519                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ApiHandler.trigger_analysis(code)                           â”‚
â”‚  â”œâ”€ ç”Ÿæˆä»»åŠ¡ IDï¼ˆUUIDï¼‰                                       â”‚
â”‚  â”œâ”€ åˆ›å»º AnalysisTaskï¼ˆçŠ¶æ€=RUNNINGï¼‰                        â”‚
â”‚  â””â”€ æäº¤åˆ°çº¿ç¨‹æ± å¼‚æ­¥æ‰§è¡Œ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åå°æ‰§è¡Œï¼š                                                   â”‚
â”‚  pipeline.process_single_stock(code)                         â”‚
â”‚  â”œâ”€ è·å–æ•°æ® â†’ åˆ†æ â†’ æ¨é€                                    â”‚
â”‚  â””â”€ æ›´æ–°ä»»åŠ¡çŠ¶æ€ï¼ˆSUCCESS/FAILEDï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æŸ¥è¯¢ï¼šGET /task?id=xxx                                   â”‚
â”‚  â””â”€ è¿”å›ä»»åŠ¡çŠ¶æ€å’Œç»“æœ                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…«ã€å…³é”®æ•°æ®æµè½¬

### 8.1 æ•°æ®æµè½¬å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤–éƒ¨æ•°æ®æº  â”‚
â”‚ (å„ç§API)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DataFetcherManager (æ•°æ®è·å–)                              â”‚
â”‚  â”œâ”€ åŸå§‹æ•°æ® â†’ æ ‡å‡†åŒ– â†’ è®¡ç®—æŠ€æœ¯æŒ‡æ ‡                          â”‚
â”‚  â””â”€ è¿”å› DataFrame (date, open, high, low, close, ...)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DatabaseManager (æ•°æ®å­˜å‚¨)                                 â”‚
â”‚  â”œâ”€ save_daily_data() - ä¿å­˜åˆ° SQLite                       â”‚
â”‚  â””â”€ get_analysis_context() - è¯»å–ä¸Šä¸‹æ–‡                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  StockAnalysisPipeline (æ•°æ®å¢å¼º)                           â”‚
â”‚  â”œâ”€ å®æ—¶è¡Œæƒ…ï¼ˆAkshareFetcherï¼‰                                â”‚
â”‚  â”œâ”€ ç­¹ç åˆ†å¸ƒï¼ˆAkshareFetcherï¼‰                                â”‚
â”‚  â”œâ”€ è¶‹åŠ¿åˆ†æï¼ˆStockTrendAnalyzerï¼‰                           â”‚
â”‚  â””â”€ æ–°é—»æƒ…æŠ¥ï¼ˆSearchServiceï¼‰                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GeminiAnalyzer (AIåˆ†æ)                                    â”‚
â”‚  â”œâ”€ æ„é€  Promptï¼ˆä¸Šä¸‹æ–‡ + äº¤æ˜“ç†å¿µï¼‰                         â”‚
â”‚  â””â”€ è°ƒç”¨ API â†’ è§£æ JSON                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NotificationService (é€šçŸ¥æ¨é€)                            â”‚
â”‚  â”œâ”€ generate_dashboard_report() - ç”ŸæˆæŠ¥å‘Š                   â”‚
â”‚  â””â”€ send() - å¤šæ¸ é“æ¨é€                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœ€ç»ˆè¾“å‡º    â”‚
â”‚ - æŠ¥å‘Šæ–‡ä»¶  â”‚
â”‚ - ä¼ä¸šå¾®ä¿¡  â”‚
â”‚ - é£ä¹¦      â”‚
â”‚ - Telegram â”‚
â”‚ - é‚®ä»¶      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 äº¤æ˜“ç†å¿µå®ç°è·¯å¾„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  äº¤æ˜“ç†å¿µåµŒå…¥ç‚¹                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€1. è¶‹åŠ¿åˆ†æå™¨ã€‘(stock_analyzer.py)
  â”œâ”€ MA5 > MA10 > MA20 å¤šå¤´æ’åˆ—åˆ¤æ–­
  â”œâ”€ ä¹–ç¦»ç‡è®¡ç®—ï¼š(ç°ä»·-MA5)/MA5 * 100%
  â”œâ”€ ä¹–ç¦»ç‡ > 5% â†’ æ ‡è®°å±é™©
  â””â”€ é‡èƒ½åˆ†æï¼ˆç¼©é‡å›è°ƒåå¥½ï¼‰

ã€2. AI åˆ†æå™¨ã€‘(analyzer.py)
  â””â”€ SYSTEM_PROMPT ä¸­åµŒå…¥äº¤æ˜“ç†å¿µ
      â”œâ”€ "ä¸¥è¿›ç­–ç•¥ï¼ˆä¸è¿½é«˜ï¼‰"
      â”œâ”€ "è¶‹åŠ¿äº¤æ˜“ï¼ˆé¡ºåŠ¿è€Œä¸ºï¼‰"
      â”œâ”€ "æ•ˆç‡ä¼˜å…ˆï¼ˆç­¹ç ç»“æ„ï¼‰"
      â”œâ”€ "ä¹°ç‚¹åå¥½ï¼ˆå›è¸©æ”¯æ’‘ï¼‰"
      â””â”€ "é£é™©æ’æŸ¥é‡ç‚¹"

ã€3. å†³ç­–ä»ªè¡¨ç›˜ã€‘(AnalysisResult)
  â”œâ”€ battle_plan.sniper_pointsï¼ˆç‹™å‡»ç‚¹ä½ï¼‰
  â”œâ”€ battle_plan.action_checklistï¼ˆæ£€æŸ¥æ¸…å•ï¼‰
  â””â”€ intelligence.risk_alertsï¼ˆé£é™©è­¦æŠ¥ï¼‰
```

---

## ä¹ã€é”™è¯¯å¤„ç†ä¸é‡è¯•æœºåˆ¶

### 9.1 æ•°æ®è·å–é‡è¯•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DataFetcherManager - å¤šæ•°æ®æºé™çº§                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  for fetcher in fetchers:
    try:
      return fetcher.get_daily_data()
    except (RateLimitError, TimeoutError):
      continue  # å°è¯•ä¸‹ä¸€ä¸ªæ•°æ®æº
    except Exception:
      logger.error(f"{fetcher.name} å¤±è´¥ï¼Œåˆ‡æ¢ä¸‹ä¸€ä¸ª")
      continue
  raise DataSourceUnavailableError("æ‰€æœ‰æ•°æ®æºå‡ä¸å¯ç”¨")
```

### 9.2 AI è°ƒç”¨é‡è¯•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GeminiAnalyzer - åacity é‡è¯•æœºåˆ¶                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  @retry(
    stop=stop_after_attempt(5),
    wait=wait_exponential(multiplier=1, min=2, max=10),
    retry=retry_if_exception_type(Exception),
    before_sleep=before_sleep_log(logger, logging.WARNING)
  )
  def _call_gemini_api(self, prompt):
    return model.generate_content(prompt)
```

### 9.3 é€šçŸ¥æ¨é€å®¹é”™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NotificationService - å¤šæ¸ é“å®¹é”™                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  for channel in channels:
    try:
      if channel == WECHAT:
        success = send_to_wechat(content)
      elif channel == FEISHU:
        success = send_to_feishu(content)
      # ...
      if success:
        logger.info(f"{channel} æ¨é€æˆåŠŸ")
      else:
        logger.warning(f"{channel} æ¨é€å¤±è´¥")
    except Exception as e:
      logger.error(f"{channel} æ¨é€å¼‚å¸¸: {e}")
```

---

## åã€å®Œæ•´æ‰§è¡Œæ—¶åºå›¾

```
ç”¨æˆ· â†’ main.py â†’ StockAnalysisPipeline
  â†“        â†“              â†“
å¯åŠ¨    åŠ è½½é…ç½®      åˆå§‹åŒ–å„æ¨¡å—
         â†“              â†“
       è§£æå‚æ•°    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“         â”‚ å¹¶å‘å¤„ç†    â”‚
       éªŒè¯é…ç½®    â”‚ (ThreadPool) â”‚
         â†“         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“              â†“
       è¿è¡Œæ¨¡å¼   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“       â”‚ å¯¹æ¯åªè‚¡ç¥¨æ‰§è¡Œ              â”‚
         â†“       â”‚ 1. è·å–æ•°æ® (DataFetcher)   â”‚
         â†“       â”‚ 2. ä¿å­˜æ•°æ® (Database)     â”‚
         â†“       â”‚ 3. å®æ—¶è¡Œæƒ… (Akshare)       â”‚
         â†“       â”‚ 4. ç­¹ç åˆ†å¸ƒ (Akshare)       â”‚
         â†“       â”‚ 5. è¶‹åŠ¿åˆ†æ (TrendAnalyzer) â”‚
         â†“       â”‚ 6. æ–°é—»æœç´¢ (SearchService) â”‚
         â†“       â”‚ 7. AIåˆ†æ (GeminiAnalyzer)  â”‚
         â†“       â”‚ 8. å•è‚¡æ¨é€ (å¯é€‰)          â”‚
         â†“       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“              â†“
       æ±‡æ€»ç»“æœ    æ”¶é›†æ‰€æœ‰ AnalysisResult
         â†“              â†“
       å¤§ç›˜å¤ç›˜    MarketAnalyzer
         â†“              â†“
       é£ä¹¦æ–‡æ¡£    FeishuDocManager
         â†“              â†“
       æ±‡æ€»æ¨é€    NotificationService
         â†“              â†“
         â†“         ä¼ä¸šå¾®ä¿¡/é£ä¹¦/Telegram/é‚®ä»¶
         â†“              â†“
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ å®Œæˆ
```

---

## æ€»ç»“

### æ ¸å¿ƒç‰¹ç‚¹ï¼š

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šå„æ¨¡å—èŒè´£æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
2. **å¤šæ•°æ®æºé™çº§**ï¼šç¡®ä¿æ•°æ®è·å–çš„é«˜å¯ç”¨æ€§
3. **ä½å¹¶å‘é˜²å°**ï¼š3çº¿ç¨‹å¹¶å‘ + éšæœºå»¶æ—¶ï¼ˆ2-5ç§’ï¼‰
4. **æ–­ç‚¹ç»­ä¼ **ï¼šæ•°æ®åº“è®°å½•å·²è·å–æ•°æ®ï¼Œé¿å…é‡å¤è¯·æ±‚
5. **äº¤æ˜“ç†å¿µåµŒå…¥**ï¼šä»è¶‹åŠ¿åˆ†æå™¨åˆ°AI Promptå…¨ç¨‹ä½“ç°
6. **å¤šæ¸ é“é€šçŸ¥**ï¼šæ”¯æŒ6ç§æ¨é€æ¸ é“ï¼Œè‡ªåŠ¨è¯†åˆ«
7. **ä¼˜é›…é™çº§**ï¼šå•è‚¡å¤±è´¥ä¸å½±å“æ•´ä½“ï¼Œå•æ¸ é“å¤±è´¥ä¸å½±å“å…¶ä»–

### æ‰§è¡Œæ—¶é—´ä¼°ç®—ï¼š

- å•åªè‚¡ç¥¨åˆ†æï¼šçº¦ 5-15 ç§’ï¼ˆå–å†³äºç½‘ç»œå’ŒAIå“åº”ï¼‰
- 3åªè‚¡ç¥¨å¹¶å‘ï¼šçº¦ 10-20 ç§’
- å¤§ç›˜å¤ç›˜ï¼šçº¦ 5-10 ç§’
- æ€»è€—æ—¶ï¼šçº¦ 15-30 ç§’ï¼ˆ3åªè‚¡ç¥¨ï¼‰
